# Система сертификации svsp (SCRT-system)

SCRT-system - криптосистема, позволяющая производить сертификацию внутри проектов. Используется для профилактики несанкционированного доступа к сервисам.
Основная цель системы - реализация простого и быстрого способа передачи данных по незащищенным сетевым каналам.

Состоит из связки "*центр сертификации - хост сервер - клиенты*".

Хост сервер и центр сертификации написаны на php. Клиенты написаны на java и js. На языке java существует две версии - для android и версия для остальных приложений, независящая от android sdk.

# Центр сертификации

Центром сертификации выступает отдельный сервер, который выдает сертификаты и проверяет валидность этих сертификатов по запросам клиентов. 

**Установка и настройка центра сертификации svsp**

Для создания центра сертификации сервер должен поддерживать PHP и иметь модули openssl и  BCMath. Чтобы центр сертификации заработал, необходимо расположить директорию "*scrt-system_v3*" в любом месте сервера,
но желательно в корне. В последствии путь к директориям SCRT-system указывается в конфигурационных полях на клиентах.

**Устройство центра сертификации svsp**

Центр сертификации состоит из двух модулей - системы создания сертификатов и API для проверки валидности сертификатов. Вся информация между модулями, файлами
центра сертификации передается в зашифрованном виде (за исключением MySql).

![image](https://user-images.githubusercontent.com/77344156/211185025-33e5c872-dd41-49f9-908f-7e24865e8e7f.png)
*Экран входа в систему создания сертификатов*

При создании сертификатов и продуктов указывается два параметра - имя и срок регистрации. Срок регистрации - срок, в течении которого сертификат или продукт 
являются валидными.

При добавлении продукта создается новая строка в базе данных. Имена продуктов должны быть индивидуальными. По истечению срока регистрации продукта все сертификаты,
созданные для этого продукта, считаются аннулированными.

При создании сертификата в закрытой папке *sertificates* создается файл формата *.scrt*, который хранит поля только что созданного сертификата в открытом
виде. Данный файл необходимо будет передать стороне, для которой создавался сертификат. В папке *sertificates/hes_cert* также создается файл формата *.scrt*, 
однако этот файл хранит поля сертификата в закрытом виде. Данный файл нельзя перемещать,
удалять или модифицировать так как он используется при проверке валидности сертификатов.

Открытым ключом сертификата являются два значения - *root* и *prime* - значения, необходимые для поддержания работоспособности алгоритма Диффи - Хеллмана. 
Получить данные значения можно на клиентской стороне.

**Установка центра сертификации**

Для установки центра сертификации необходимо на сервер, удовлетворяющий условиям, перечисленным выше, загрузить файл *setup.php* (*crt-center* в репозитории).
Файл требуется загрузить в корневую директорию сервера. Затем необходимо отправить *GET* запрос к этому файлу с аттрибутами, перечисленными ниже:

-   dbhost - адрес сервера базы данных;
-   dbuser - пользователь базы данных;
-   dbpass - пароль пользователя базы данных;
-   db - имя базы данных;
-   getpass - пароль, передаваемый файлу *index.php* как атрибут "*p*" GET запроса для доступа к системе;
-   user - имя пользователя для доступа к системе; 
-   pass - пароль для доступа к системе

После этого в корневой директории появятся папки с необходимыми файлами, а также файл *index.php*.

# Клиенты

Для проверки сертификатов на клиентской стороне используется библиотека *check_certificate_svsp_certificate_system.js*. В библиотеке определены 4 функции 
для взаимодействия с сертификатом и центрами сертификации. 

**Хранение выданных сертификатов**

Выданные центром сертификаты хранятся в любой папке на сервере (например *scert*). В этой папке должен быть файл *cert.php* (к которому 
обращается библиотека) и папка *cert*, в которой непосредственно хранится открытый сертификат с именем *cert.scrt*. Во избежании кражи сертификата в папке 
*cert* необходимо расположить конфигурационный файл *.htaccess*, в котором нужно запретить доступ к папке из вне.

*Структура:*

- htdocs
    + scert
        * cert.php
        * cert
            - cert.scrt
            - .htaccess

**Функции библиотеки**

`function getSCRTcertificate(callBack, dir)`

Получает массив строк сертификата в открытом виде. Всего строк в сертификате 10.

- callBack - функция обратного вызова, в первый аргумент которой передается массив строк.
- dir - директория расположения сертификата (в примере выше */scert*);

`function getSCRTroot(callBack, dir)`

Получает открытое значение *root*.

- callBack - функция обратного вызова, в первый аргумент которой передается значение.
- dir - директория расположения сертификата (в примере выше */scert*);

`function getSCRTprime(callBack, dir)`

Получает открытое значение *prime*.

- callBack - функция обратного вызова, в первый аргумент которой передается значение.
- dir - директория расположения сертификата (в примере выше */scert*);

`function checkSCRTcertificate(nums, scrtCenter, callBack)`

Проверяет валидность сертификата на сервере сертификации.

- nums - массив строк необходимого сертификата. Массив можно получить с помощью функции getSCRTcertificate.
- scrtCenter - адрес сервера сертификации (например *http://127.0.0.1*).
- callBack - функция обратного вызова, в первый аргумент которой передается булево значение; если сертификат валидный - значение *true*, иначе *false*.



